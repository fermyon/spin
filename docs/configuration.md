# Configuration for Spin applications

A _Spin application_ is a collection of at least one _component_, each
instantiated as a result of an _event_ generated by a _trigger_.

In the example below we can see a simple application with a single component,
executed when the `/hello` endpoint is accessed:

```toml
name        = "spin-hello-world"
version     = "1.0.0"
description = "A simple application that returns hello and goodbye."
authors     = [ "Radu Matei <radu@fermyon.com>" ]
trigger     = {type = "http", base = "/" }

[[component]]
    source = "target/wasm32-wasi/release/spinhelloworld.wasm"
    id     = "hello"
[component.trigger]
    route = "/hello"
```

All components of an application must be executed by the same trigger type.

## The `spin.toml` configuration file

Currently, the only configuration file for a Spin application is the `spin.toml`
file. This might change in the future (it could potentially be generated from
multiple configuration sources), as this file currently mixes build- and
run-time concerns.

These are the fields currently supported for the configuration:

- `name` (REQUIRED): Name of the application.
- `version` (REQUIRED): Version of the application.
- `description` (OPTIONAL): Description of the application.
- `authors` (OPTIONAL): Authors of the application.
- `namespace` (OPTIONAL): Logical grouping of the application at runtime.
- `component` (REQUIRED): List with the components of the application.
- `trigger` (REQUIRED): Application trigger and configuration. (Currently, the
  only implemented trigger is `http`, and the application base path can be
  configured (`base`), and will be prepended to the routes individual components
  are handling. For example, if `base = "/foo"`, and a component
  `route = "/bar/..."`, that component will handle incoming requests for
  `/foo/bar/...`.)

Each `component` object has the following fields:

- `id` (REQUIRED): ID of the component, used at runtime to select between
  multiple components of the same application.
- `source` (REQUIRED): Source for the component. Can either be a path to a local
  file, or a pair of `reference` (REQUIRED) and `parcel` (REQUIRED) fields
  pointing to a remote bindle.
- `environment` (OPTIONAL): Environment variables to be mapped inside the Wasm
  module at runtime.
- `files` (OPTIONAL): Paths (relative to the configuration file) of files to be
  mapped inside the Wasm module at runtime.
- `allowed_http_hosts` (OPTIONAL): List of HTTP hosts the component is allowed
  to connect to.
- `trigger` (REQUIRED): Trigger configuration for the component.
- `dependencies` (OPTIONAL): List of dependencies to be resolved and satisfied
  at runtime by the host.
- `build` (OPTIONAL): Currently unused build information or configuration that
  could be used by a plugin to build the component.

### Component sources

When writing a `spin.toml` file, components can either come from a local file,
or be they can reference a remote bindle.

As such, the `source` field in the component configuration can either directly
point to the path:

```toml
  source = "path/to/wasm/file.wasm"
```

Or it can be an object containing the bindle reference and parcel:

```toml
[component.source]
    reference = "bindle reference"
    parcel    = "parcel"
```

### Triggers

Triggers in Spin are components that generate events that cause the execution of
components. Currently, the only trigger implemented for Spin is the HTTP
trigger, which contains the following fields:

- `route` (REQUIRED): The HTTP route the component will be invoked for.
- `executor` (REQUIRED): The object that sets an executor. There are currently two executor `type`s:
  - `spin` uses the Spin HTTP executor
  - `wagi` uses the Wagi CGI executor



```toml
[component.trigger]
    route          = "/hello"
    executor = { type = "spin" }
    # executor = { type="wagi" }
```

### Wagi Executor

Some executors have additional configuration. Wagi supports the following extra configurations:

- `argv` (OPTIONAL): The string representation of the `argv` list that should be passed into the handler. `${SCRIPT_NAME}` will be replaced with the script name, and `${ARGS}` will be replaced with the query parameters of the request, formatted as arguments. The default is to follow the CGI specification, and pass `${SCRIPT_NAME} ${ARGS}`
- `entrypoint` (OPTIONAL, EXPERT): The name of the function that should be called as the entrypoint to this handler. By default, it is `_start` (which in most languages translates to calling `main` in the guest module).

```toml
[component.trigger]
route = "/..."
executor = {type="wagi", argv="test ${SCRIPT_NAME} ${ARGS} done", entrypoint="_start"}
```

### Dependencies

Each entry in the `dependencies` table should correspond to exactly one import
module from the Wasm module. Currently, this map should either contain an
interface that should be satisfied by the host runtime (through a host
implementation), or an exact reference (_not_ a version range or constraint) to
a component from the registry. The fields in a dependency section are:

- `type` (REQUIRED): The type of the dependency. Possible values: `host` or
  `component`.
- `reference` (OPTIONAL): Reference to a component from the registry. Required
  if `type` is `component`.
- `parcel` (OPTIONAL): Parcel to use from the bindle reference. Required if
  `type` is `component`.

## Glossary

- WebAssembly module (or "module") — compilation artifact targeting
  `wasm32-wasi` that adheres to
  [the Wasm specification](https://webassembly.org/specs/).

- WebAssembly component (or "component") — compilation artifact targeting
  `wasm32-wasi` that adheres to
  [the WebAssembly component model](https://github.com/WebAssembly/component-model/blob/main/design/high-level/Goals.md),
  and whose imports and exports use
  [interface types](https://github.com/WebAssembly/interface-types)
